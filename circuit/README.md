# ë‚˜ì´ ì¸ì¦ ZK íšŒë¡œ (Age Verification ZK Circuit)

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” Noirë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ëœ ë‚˜ì´ ì¸ì¦ Zero-Knowledge ì¦ëª… íšŒë¡œì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì‹¤ì œ ë‚˜ì´ë¥¼ ê³µê°œí•˜ì§€ ì•Šê³ ë„ ìµœì†Œ ë‚˜ì´ ìš”êµ¬ì‚¬í•­(20ì„¸)ì„ ë§Œì¡±í•¨ì„ ì¦ëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ”§ ìš”êµ¬ì‚¬í•­

-   [Noir](https://noir-lang.org/) (nargo)
-   [Barretenberg](https://github.com/AztecProtocol/barretenberg) (bb CLI)

## ğŸ—ï¸ íšŒë¡œ ì„¤ê³„

### Public Inputs (ê³µê°œ ì…ë ¥)

-   `commitment`: ë‚˜ì´ ì •ë³´ì˜ ì»¤ë°‹ë¨¼íŠ¸ (Hash(age || nonce))
-   `min_age`: ìµœì†Œ ë‚˜ì´ ìš”êµ¬ì‚¬í•­ (20ì„¸)

### Private Inputs (ë¹„ê³µê°œ ì…ë ¥)

-   `age`: ì‹¤ì œ ë‚˜ì´
-   `nonce`: ì»¤ë°‹ë¨¼íŠ¸ ìƒì„±ìš© ì„ì˜ ê°’ (ì†”íŠ¸)

### ê²€ì¦ ë¡œì§

1. **ì»¤ë°‹ë¨¼íŠ¸ ê²€ì¦**: `commitment = pedersen_hash([age, nonce])`
2. **ë‚˜ì´ ì¡°ê±´ ê²€ì¦**: `age >= min_age`

## ğŸš€ ì‚¬ìš© ë°©ë²•

### 1. ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ê°„ë‹¨í•œ ì‹¤í–‰ (commitment ìë™ ê³„ì‚°)
./run_test.sh

# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
chmod +x test_circuit.sh
./test_circuit.sh
```

### 2. ë‚˜ì´ ë³€ê²½í•˜ì—¬ í…ŒìŠ¤íŠ¸

ë‹¨ìˆœíˆ `Prover.toml`ì˜ `age` ê°’ë§Œ ë³€ê²½í•˜ë©´ ë©ë‹ˆë‹¤:

```toml
# Prover.toml
age = "30"  # ì›í•˜ëŠ” ë‚˜ì´ë¡œ ë³€ê²½
nonce = "12345"  # ì›í•˜ëŠ” nonce ê°’ìœ¼ë¡œ ë³€ê²½

# commitmentëŠ” ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤!
commitment = "0x0000000000000000000000000000000000000000000000000000000000000000"
min_age = "20"
```

### 3. ìˆ˜ë™ ì‹¤í–‰ (ê³ ê¸‰ ì‚¬ìš©ì)

```bash
# 1. íšŒë¡œ ë¹Œë“œ
nargo build

# 2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
nargo test

# 3. íšŒë¡œ ì‹¤í–‰ (witness ìƒì„±)
nargo execute

# 4. ì¦ëª… ìƒì„± (Barretenberg ì‚¬ìš©)
bb prove -b ./target/circuit.json -w ./target/circuit.gz -o ./target

# 5. ê²€ì¦í‚¤ ìƒì„±
bb write_vk -b ./target/circuit.json -o ./target

# 6. ì¦ëª… ê²€ì¦
bb verify -k ./target/vk -p ./target/proof -i ./target/public_inputs
```

## ğŸ”„ ìë™ Commitment ê³„ì‚° ì‹œìŠ¤í…œ

### íŠ¹ì§•

-   **ìë™ ê³„ì‚°**: `age`ì™€ `nonce` ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ commitment ìë™ ê³„ì‚°
-   **ë™ì  ì—…ë°ì´íŠ¸**: `Prover.toml`ì˜ commitment ê°’ ìë™ ì—…ë°ì´íŠ¸
-   **ì˜¤ë¥˜ ë°©ì§€**: ìˆ˜ë™ ê³„ì‚°ìœ¼ë¡œ ì¸í•œ ì‹¤ìˆ˜ ë°©ì§€

### ì‘ë™ ì›ë¦¬

1. ìŠ¤í¬ë¦½íŠ¸ê°€ `Prover.toml`ì—ì„œ `age`ì™€ `nonce` ê°’ì„ ì½ìŒ
2. `pedersen_hash([age, nonce])` ê³„ì‚°
3. ê³„ì‚°ëœ ê°’ìœ¼ë¡œ `Prover.toml`ì˜ `commitment` í•„ë“œ ìë™ ì—…ë°ì´íŠ¸
4. ì—…ë°ì´íŠ¸ëœ ê°’ìœ¼ë¡œ ZK ì¦ëª… ìƒì„± ë° ê²€ì¦

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
circuit/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.nr              # ë©”ì¸ íšŒë¡œ ì½”ë“œ
â”œâ”€â”€ Nargo.toml               # Noir í”„ë¡œì íŠ¸ ì„¤ì •
â”œâ”€â”€ Prover.toml              # ì¦ëª…ì ì…ë ¥ ë°ì´í„° (age, nonceë§Œ ì„¤ì •)
â”œâ”€â”€ test_circuit.sh          # ìë™ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ run_test.sh              # ê°„ë‹¨í•œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ README.md                # ì´ íŒŒì¼
â””â”€â”€ target/                  # ë¹Œë“œ ê²°ê³¼ ë° ì¦ëª… íŒŒì¼ë“¤
    â”œâ”€â”€ circuit.json         # íšŒë¡œ íŒŒì¼
    â”œâ”€â”€ circuit.gz           # Witness íŒŒì¼
    â”œâ”€â”€ proof                # ì¦ëª… íŒŒì¼
    â”œâ”€â”€ public_inputs        # Public Inputs íŒŒì¼
    â””â”€â”€ vk                   # ê²€ì¦í‚¤ íŒŒì¼
```

## ğŸ’¡ ì˜ˆì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: 21ì„¸ ì‚¬ìš©ìì˜ ì„±ì¸ ì¸ì¦

**ì…ë ¥ ë°ì´í„°** (`Prover.toml`):

```toml
# Private inputs (witness)
age = "21"
nonce = "12345"

# Public inputs (commitmentëŠ” ìë™ ê³„ì‚°ë¨)
commitment = "0x0000000000000000000000000000000000000000000000000000000000000000"
min_age = "20"
```

**ê²°ê³¼**: âœ… Pass (20ì„¸ ì´ìƒ)

### ì‹œë‚˜ë¦¬ì˜¤ 2: 30ì„¸ ì‚¬ìš©ì í…ŒìŠ¤íŠ¸

**ì…ë ¥ ë°ì´í„°** (`Prover.toml`):

```toml
age = "30"
nonce = "54321"
commitment = "0x0000000000000000000000000000000000000000000000000000000000000000"
min_age = "20"
```

**ê²°ê³¼**: âœ… Pass (20ì„¸ ì´ìƒ)

### ì‹œë‚˜ë¦¬ì˜¤ 3: 19ì„¸ ì‚¬ìš©ì (ì‹¤íŒ¨ ì¼€ì´ìŠ¤)

**ì…ë ¥ ë°ì´í„°** (`Prover.toml`):

```toml
age = "19"
nonce = "99999"
commitment = "0x0000000000000000000000000000000000000000000000000000000000000000"
min_age = "20"
```

**ê²°ê³¼**: âŒ Fail (20ì„¸ ë¯¸ë§Œ)

## ğŸ” Zero-Knowledge ì¦ëª…ì˜ íŠ¹ì§•

-   **í”„ë¼ì´ë²„ì‹œ**: ì‹¤ì œ ë‚˜ì´ë¥¼ ê³µê°œí•˜ì§€ ì•ŠìŒ
-   **ê²€ì¦ ê°€ëŠ¥**: ìµœì†Œ ë‚˜ì´ ìš”êµ¬ì‚¬í•­ ë§Œì¡± ì—¬ë¶€ë¥¼ ìˆ˜í•™ì ìœ¼ë¡œ ì¦ëª…
-   **ì‹ ë¢°ì„±**: ìœ„ì¡° ë¶ˆê°€ëŠ¥í•œ ì•”í˜¸í•™ì  ì¦ëª…
-   **ìë™í™”**: Commitment ê°’ ìë™ ê³„ì‚°ìœ¼ë¡œ ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒ

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤

-   `test_valid_age`: 25ì„¸ â†’ 20ì„¸ ì´ìƒ (ì„±ê³µ)
-   `test_exact_min_age`: 20ì„¸ â†’ 20ì„¸ ì´ìƒ (ì„±ê³µ)
-   `test_invalid_age_should_fail`: 19ì„¸ â†’ 20ì„¸ ë¯¸ë§Œ (ì‹¤íŒ¨)
-   `test_invalid_commitment_should_fail`: ì˜ëª»ëœ ì»¤ë°‹ë¨¼íŠ¸ (ì‹¤íŒ¨)
-   `test_calculate_commitment_from_prover_toml`: ìë™ commitment ê³„ì‚° (ìŠ¤í¬ë¦½íŠ¸ ì „ìš©)

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **bb ëª…ë ¹ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ**

    - Barretenberg ì„¤ì¹˜ í™•ì¸
    - PATH í™˜ê²½ë³€ìˆ˜ í™•ì¸

2. **íŒŒì¼ ê¶Œí•œ ì˜¤ë¥˜**

    - `chmod +x *.sh`ë¡œ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬

3. **Commitment ê³„ì‚° ì˜¤ë¥˜**

    - ìë™ ê³„ì‚° ì‹œìŠ¤í…œ ì‚¬ìš© (ë” ì´ìƒ ìˆ˜ë™ ê³„ì‚° ë¶ˆí•„ìš”)
    - `Prover.toml`ì˜ age, nonce ê°’ í™•ì¸

4. **macOS/Linux í˜¸í™˜ì„±**
    - ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ OS ê°ì§€í•˜ì—¬ ì ì ˆí•œ ëª…ë ¹ì–´ ì‚¬ìš©

## ğŸ“š ì¶”ê°€ ìë£Œ

-   [Noir ê³µì‹ ë¬¸ì„œ](https://noir-lang.org/docs)
-   [Barretenberg ë¬¸ì„œ](https://github.com/AztecProtocol/barretenberg)
-   [Zero-Knowledge ì¦ëª… ì†Œê°œ](https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell)
